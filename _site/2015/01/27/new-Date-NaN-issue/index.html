<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>IE new Date(str)返回NaN的坑</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="使用new Date(str)的时候，chrome和firefox都是正常返回，但是IE就会出现NaN。">
    <link rel="canonical" href="/2015/01/27/new-Date-NaN-issue/">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/core.css">
    <link rel="stylesheet" href="/css/pygments.css">
    <link rel="stylesheet" href="/css/main.css">
</head>

    <body>
    	<section class="main-content wrap">
    		<section class="leftBar">
    			<ul class="leftBarNav list-unstyled">
    				<li>
    					<a href="/"><img src="/img/icon-blog.png"></a>
    				</li>
    				<li>
    					<a href="/note"><img src="/img/icon-note.png"></a>
    				</li>
    				<li>
    					<a href="/demo"><img src="/img/icon-demo.png"></a>
    				</li>
    				<li>
    					<a href="/about"><img src="/img/icon-about.png"></a>
    				</li>
       			</ul>
    		</section>
    		<section class="content">
    			<section class="posts">
	<section class="post-item">
		<h1 class="post-title">IE new Date(str)返回NaN的坑</h1>
		<span class="post-date">
			Jan 27, 2015
		</span>

		<article class="post-content">
	  		<p>使用new Date(str)的时候，chrome和firefox都是正常返回，但是IE就会出现NaN。</p>

<p>在stackoverflow寻找了一圈之后，发现遇到类似问题的人很多，已经有人写出通用的

	<a href="https://gist.github.com/spazmodius/1477907" target="_blank">转换函数(需要翻墙)</a>了

</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">ParseISO8601</span><span class="p">(</span><span class="nx">iso</span><span class="p">){</span>
	<span class="c1">// 0 = whole string</span>
	<span class="c1">// 1 = year</span>
	<span class="c1">// 2 = month</span>
	<span class="c1">// 3 = day</span>
	<span class="c1">// 4 = whole time part</span>
	<span class="c1">// 5 = hour</span>
	<span class="c1">// 6 = minute</span>
	<span class="c1">// 7 = second</span>
	<span class="c1">// 8 = fractional (with dot)</span>
	<span class="c1">// 9 = whole timezone (possibly Z)</span>
	<span class="c1">// 10 = offset sign (+ or -)</span>
	<span class="c1">// 11 = offset hours</span>
	<span class="c1">// 12 = offset minutes (with colon)</span>
	<span class="c1">// 13 = offset minutes</span>
	<span class="nx">_rxISO</span> <span class="o">:</span> <span class="sr">/^(\d{4})-(\d\d)-(\d\d)([T ](\d\d):(\d\d):(\d\d)(\.\d+)?(Z|([+-])(\d\d)(:(\d\d))?)?)?$/</span><span class="p">,</span>
		
	<span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">System</span><span class="p">.</span><span class="nb">Date</span><span class="p">.</span><span class="nx">_rxISO</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">iso</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">)</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">iso</span><span class="p">));</span>

	<span class="kd">var</span> <span class="nx">year</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nx">month</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">day</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">year</span><span class="p">,</span> <span class="nx">month</span><span class="p">,</span> <span class="nx">day</span><span class="p">);</span>

	<span class="kd">var</span> <span class="nx">hour</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="nx">minute</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="nx">second</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>
	<span class="kd">var</span> <span class="nx">ms</span> <span class="o">=</span> <span class="nx">r</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">?</span> <span class="nb">Number</span><span class="p">((</span><span class="nx">r</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;000&quot;</span><span class="p">).</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">year</span><span class="p">,</span> <span class="nx">month</span><span class="p">,</span> <span class="nx">day</span><span class="p">,</span> <span class="nx">hour</span><span class="p">,</span> <span class="nx">minute</span><span class="p">,</span> <span class="nx">second</span><span class="p">,</span> <span class="nx">ms</span><span class="p">);</span>

	<span class="kd">var</span> <span class="nx">oh</span> <span class="o">=</span> <span class="nx">r</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">?</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span> <span class="o">+</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span><span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">om</span> <span class="o">=</span> <span class="nx">r</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="o">?</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span> <span class="o">+</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span><span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="nx">hour</span> <span class="o">-=</span> <span class="nx">oh</span><span class="p">;</span>
	<span class="nx">minute</span> <span class="o">-=</span> <span class="nx">om</span><span class="p">;</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">UTC</span><span class="p">(</span><span class="nx">year</span><span class="p">,</span> <span class="nx">month</span><span class="p">,</span> <span class="nx">day</span><span class="p">,</span> <span class="nx">hour</span><span class="p">,</span> <span class="nx">minute</span><span class="p">,</span> <span class="nx">second</span><span class="p">,</span> <span class="nx">ms</span><span class="p">));</span>
<span class="p">}</span></code></pre></div> 

	  	</article>
	</section>
</section>
    		</section>
    	</section>
    </body>
</html>